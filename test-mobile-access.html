<!DOCTYPE html>
<html>
<head>
    <title>Mobile LiveSync Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <h1>Mobile LiveSync CORS Test</h1>
    <button onclick="testDirectCouchDB()">Test Direct CouchDB (5984)</button><br><br>
    <button onclick="testNginxProxy()">Test Nginx Proxy (3880)</button><br><br>
    <button onclick="testFetchAPI()">Test Fetch API</button><br><br>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        
        function log(message) {
            results.innerHTML += '<p>' + message + '</p>';
        }
        
        async function testDirectCouchDB() {
            results.innerHTML = '<h2>Testing Direct CouchDB...</h2>';
            try {
                const response = await fetch('http://100.68.79.63:5984/', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Basic ' + btoa('obsidian_admin:Rjm/gUGa04cFTrE7SzLL5v/6w5MTaWah2Ck5tboySMU=')
                    }
                });
                log('Direct CouchDB Status: ' + response.status);
                const data = await response.json();
                log('Direct CouchDB Response: ' + JSON.stringify(data));
            } catch (error) {
                log('Direct CouchDB Error: ' + error.message);
            }
        }
        
        async function testNginxProxy() {
            results.innerHTML = '<h2>Testing Nginx Proxy...</h2>';
            try {
                const response = await fetch('http://100.68.79.63:3880/', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Basic ' + btoa('obsidian_admin:Rjm/gUGa04cFTrE7SzLL5v/6w5MTaWah2Ck5tboySMU=')
                    }
                });
                log('Nginx Proxy Status: ' + response.status);
                const data = await response.json();
                log('Nginx Proxy Response: ' + JSON.stringify(data));
            } catch (error) {
                log('Nginx Proxy Error: ' + error.message);
            }
        }
        
        async function testFetchAPI() {
            results.innerHTML = '<h2>Testing Fetch API Capabilities...</h2>';
            
            // Test basic fetch
            try {
                const response = await fetch('https://httpbin.org/json');
                log('Basic fetch works: ' + response.status);
            } catch (error) {
                log('Basic fetch failed: ' + error.message);
            }
            
            // Test CORS
            try {
                const response = await fetch('https://httpbin.org/get', {
                    method: 'GET',
                    mode: 'cors'
                });
                log('CORS fetch works: ' + response.status);
            } catch (error) {
                log('CORS fetch failed: ' + error.message);
            }
        }
    </script>
</body>
</html>